# Ticket #910: TypeScript Definitions & JSDoc Support

## Status: ðŸš§ In Progress

## Overview
Generate TypeScript definition files (.d.ts) and JSDoc comments for the distributed JavaScript to provide excellent IDE support. Since users only consume pre-built files and never run the build process, we keep JavaScript generation in Rust and focus on developer experience through type definitions.

## Files to Read First (Understanding Current System)
Before implementing, read these files to understand the existing JavaScript generation:

1. **Current JavaScript Generation**:
   - `/src/js/mod.rs` - Current JavaScript generation in Rust
   - `/src/typography/mod.rs` - Typography engine JavaScript
   - `/src/builder/mod.rs` - How JS files are currently created

2. **Build System**:
   - `/src/main.rs` - Main build orchestration
   - `/Cargo.toml` - Current dependencies

3. **Documentation for Context**:
   - `/docs/develop/201-architecture.md` - TypeScript/SWC pipeline section
   - `/docs/develop/321-javascript-api.md` - JavaScript API that needs typing

## Objectives
- Generate comprehensive .d.ts file for TypeScript users
- Add JSDoc comments to generated JavaScript
- Provide excellent IDE autocomplete and IntelliSense
- Keep JavaScript generation in Rust (simpler, faster)
- No TypeScript compilation needed (users get dist files only)
- Maintain optional JavaScript (CSS works without it)

## Technical Requirements

### 1. TypeScript Definitions Strategy
- Generate single `reedstyle.d.ts` file
- Include all public APIs and types
- Ship with dist files for TypeScript users
- No compilation, just type definitions

### 2. JSDoc Generation in Rust
Update `/src/js/mod.rs` to include JSDoc:
```rust
// Example JSDoc generation
js.push_str(r#"
/**
 * Initialize ReedStyle framework
 * @returns {Promise<void>}
 */
init: async function() {
    // implementation
}
"#);
```

### 3. Keep Current Architecture
- JavaScript stays generated by Rust
- No TypeScript source files needed
- No TSC compilation step
- Users get pre-built dist files only

### 4. Type Definitions File
Create comprehensive `dist/reedstyle.d.ts`:
```typescript
// reedstyle.d.ts
declare namespace ReedStyle {
  interface Config {
    components?: string;
    effects?: boolean;
    lazy?: boolean;
  }
  
  function init(config?: Config): void;
  function createElement(type: string, props?: object): HTMLElement;
  
  // Typography engine
  namespace typography {
    function init(lang?: string): void;
    function process(text: string, filter?: 'minimal' | 'smart' | 'professional'): string;
  }
  
  // Effects engine
  namespace effects {
    function animate(element: HTMLElement, effect: string): void;
    function scroll(element: HTMLElement, options?: object): void;
  }
}

// Custom element
interface RSElement extends HTMLElement {
  as: string;
  box?: string;
  face?: string;
  text?: string;
  layout?: string;
  device?: string;
  fx?: string;
}
```

### 5. JSDoc in Generated JavaScript
Update Rust code to include JSDoc:
```javascript
/**
 * @typedef {Object} ReedStyleConfig
 * @property {string} [components] - Path to components YAML
 * @property {boolean} [effects] - Enable effects engine
 */

/**
 * Initialize ReedStyle
 * @param {ReedStyleConfig} [config] - Configuration options
 * @returns {void}
 */
function init(config) { /* ... */ }
```

### 6. Build Integration
Update Rust build system to:
1. Generate JavaScript with JSDoc (dev build)
2. Generate minified JavaScript (prod build)
3. Write reedstyle.d.ts file
4. Include type definitions in dist/
5. No TypeScript compilation needed

## Implementation Steps

### Phase 1: Create Type Definitions
1. Write comprehensive `reedstyle.d.ts`
2. Define all interfaces and types
3. Document with TSDoc comments
4. Test in TypeScript project

### Phase 2: Add JSDoc to JavaScript
1. Update `/src/js/mod.rs`
2. Add JSDoc comments to all functions
3. Include parameter and return types
4. Test IntelliSense in VS Code

### Phase 3: Update Build System
1. Modify `/src/builder/mod.rs`
2. Write .d.ts file to dist/
3. Ensure JSDoc in dev build
4. Strip comments in prod build

### Phase 4: Documentation
1. Add TypeScript usage examples
2. Document available types
3. Show autocomplete benefits
4. Update README

## Code Structure Example
```rust
// src/builder/mod.rs
pub fn write_type_definitions() -> Result<()> {
    let dts = r#"declare namespace ReedStyle {
    interface Config {
        components?: string;
        effects?: boolean;
        typography?: boolean;
    }
    
    function init(config?: Config): Promise<void>;
    // ... more definitions
}

export = ReedStyle;
"#;
    
    fs::write("dist/reedstyle.d.ts", dts)?;
    Ok(())
}
```

## Testing Scenarios

### Test 1: Type Checking
Create intentional type error:
```typescript
const num: number = "string"; // Should fail TSC
```

### Test 2: JSDoc Generation
Verify IntelliSense in VS Code:
```javascript
ReedStyle.init({ 
  // Should show autocomplete for config options
});
```

### Test 3: Build Performance
- Measure full build time
- Should stay under 500ms total
- SWC should be <50ms

### Test 4: Output Validation
- Development: Readable with JSDoc
- Production: Minified without comments
- Both should work in browser

## Success Criteria
- [ ] reedstyle.d.ts file created with all types
- [ ] JSDoc comments in generated JavaScript
- [ ] IntelliSense works in VS Code
- [ ] TypeScript users get full type safety
- [ ] No TypeScript compilation needed
- [ ] Build remains fast (Rust only)
- [ ] Autocomplete for all APIs
- [ ] No runtime errors in browser

## Decision Log References
- DEC033: Generate d.ts file instead of TypeScript sources
- DEC034: Keep JavaScript generation in Rust
- DEC035: Add JSDoc to generated JavaScript
- DEC001: Users only use dist files, no build process

## Dependencies
- Working JavaScript generation (RS913)
- Build system (RS906) - COMPLETED âœ…

## Notes
- No TypeScript compilation needed
- Users never run build process
- JavaScript generation stays in Rust
- Single source of truth for API
- JSDoc provides IDE support for JS users
- .d.ts provides full TypeScript support

## Benefits of This Approach
- Simpler architecture (no TS compilation)
- Faster builds (Rust only)
- No Node.js dependencies for build
- Users get same experience
- Full IDE support via .d.ts and JSDoc